{"version":3,"sources":["horas.js","tags.js"],"names":["document","querySelector","busqueda","categoria_id","dia","categoria","dias","querySelectorAll","inputHiddenDia","inputHiddenHora","terminoBusqueda","e","target","name","value","horaPrevia","classList","remove","Object","values","includes","async","url","resultado","fetch","eventos","listadoHoras","forEach","li","add","horasTomadas","map","evento","hora_id","listadoHorasArray","Array","from","filter","dataset","horaId","hora","addEventListener","seleccionarHora","obtenerHorasDisponibles","json","buscarEventos","tagsInput","tags","tagsDiv","tagsInputHidden","mostrarTags","textContent","tag","etiqueta","createElement","ondblclick","eliminarTag","appendChild","actualizarInputHidden","toString","split","keyCode","trim","preventDefault"],"mappings":"CAGA,WAKA,GAHAA,SAAAC,cAAA,UAGA,CAGA,IAAAC,EAAA,CACAC,aAAA,GACAC,IAAA,IAKA,MAAAC,EAAAL,SAAAC,cAAA,yBAIAK,EAAAN,SAAAO,iBAAA,gBAGAC,EAAAR,SAAAC,cAAA,mBAEAQ,EAAAT,SAAAC,cAAA,oBAWA,SAAAS,EAAAC,GAMAT,EAAAS,EAAAC,OAAAC,MAAAF,EAAAC,OAAAE,MAIAL,EAAAK,MAAA,GACAN,EAAAM,MAAA,GAGA,MAAAC,EAAAf,SAAAC,cAAA,8BAEAc,GAEAA,EAAAC,UAAAC,OAAA,6BAMAC,OAAAC,OAAAjB,GAAAkB,SAAA,KASAC,iBAGA,MAAAjB,IAAAA,EAAAD,aAAAA,GAAAD,EAEAoB,EAAA,+BAAAlB,kBAAAD,IAGAoB,QAAAC,MAAAF,IAYA,SAAAG,GAIA,MAAAC,EAAA1B,SAAAO,iBAAA,aAEAmB,EAAAC,QAAAC,GAAAA,EAAAZ,UAAAa,IAAA,+BAKA,MAAAC,EAAAL,EAAAM,IAAAC,GAAAA,EAAAC,SAIAC,EAAAC,MAAAC,KAAAV,GAIAQ,EAAAG,OAAAT,IAAAE,EAAAV,SAAAQ,EAAAU,QAAAC,SAGAZ,QAAAC,GAAAA,EAAAZ,UAAAC,OAAA,+BAIAjB,SAAAO,iBAAA,8CAEAoB,QAAAa,GAAAA,EAAAC,iBAAA,QAAAC,IAjCAC,OAJApB,EAAAqB,QAfAC,GAwDA,SAAAH,EAAA/B,GAGA,MAAAI,EAAAf,SAAAC,cAAA,8BAEAc,GAEAA,EAAAC,UAAAC,OAAA,6BAMAN,EAAAC,OAAAI,UAAAa,IAAA,6BAMApB,EAAAK,MAAAH,EAAAC,OAAA0B,QAAAC,OAGA/B,EAAAM,MAAAd,SAAAC,cAAA,wBAAAa,MAnHAT,EAAAoC,iBAAA,SAAA/B,GAIAJ,EAAAqB,QAAAvB,GAAAA,EAAAqC,iBAAA,SAAA/B,KA/BA,GCAA,WAEA,MAAAoC,EAAA9C,SAAAC,cAAA,eAGA,GAAA6C,EAAA,CAGA,IAAAC,EAAA,GAGA,MAAAC,EAAAhD,SAAAC,cAAA,SAIAgD,EAAAjD,SAAAC,cAAA,iBA8CA,SAAAiD,IAEAF,EAAAG,YAAA,GAIAJ,EAAApB,QAAAyB,IAEA,MAAAC,EAAArD,SAAAsD,cAAA,MAEAD,EAAArC,UAAAa,IAAA,mBAEAwB,EAAAF,YAAAC,EAEAC,EAAAE,WAAAC,EAEAR,EAAAS,YAAAJ,KAIAK,IAIA,SAAAF,EAAA7C,GAEAA,EAAAC,OAAAK,SAGA8B,EAAAA,EAAAV,OAAAe,GAAAA,IAAAzC,EAAAC,OAAAuC,aAEAO,IAKA,SAAAA,IAEAT,EAAAnC,MAAAiC,EAAAY,WAhFA,KAAAV,EAAAnC,QAGAiC,EAAAE,EAAAnC,MAAA8C,MAAA,KAEAV,KAIAJ,EAAAL,iBAAA,YAGA,SAAA9B,GAGA,GAAA,KAAAA,EAAAkD,QAAA,CAIA,GAAA,KAAAlD,EAAAC,OAAAE,MAAAgD,QAAAnD,EAAAC,OAAAE,MAAA,EACA,OAKAH,EAAAoD,iBAMAhB,EAAA,IAAAA,EAAApC,EAAAC,OAAAE,MAAAgD,QAGAhB,EAAAhC,MAAA,GAGAoC,SAxDA","file":"bundle.js","sourcesContent":["//el código js irá dentro de una función IIFE (Inmediately Invoked Function Expresión), \r\n//esta función se autoejecuta inmediatamente despues de ser definida.\r\n//Se usa para evitar la contaminación del ámbito global y encapsular sus variables.\r\n(function() {\r\n    //seleciona elemento html del form con id = horas\r\n    const horas = document.querySelector('#horas');\r\n\r\n    //si existe el elemento horas, ejecuta el código\r\n    if(horas) {\r\n\r\n        //objeto para almacenar temporalmente, la categoria y el dia seleccionados en el form\r\n        let busqueda = {\r\n            categoria_id: '',\r\n            dia: ''\r\n        }\r\n\r\n        //selecciona el elemento html cuyo atributo name=\"categoria_id\",\r\n        //el select de categoria del fomrulario\r\n        const categoria = document.querySelector('[name=\"categoria_id\"]');\r\n        //selecciona todos elementos html cuyo atributo name=\"dia\",\r\n        //son todas las opciones del input type radio, obtenidas de la var $dias,\r\n        //que contiene los elementos con id 1 Viernes y 2 Sábado, de la tabla dias, de la DB\r\n        const dias = document.querySelectorAll('[name=\"dia\"]');\r\n\r\n        //selecciona elemento html cuyo atributo name=\"dia_id\". El input oculto.\r\n        const inputHiddenDia = document.querySelector('[name=\"dia_id\"]');\r\n        //selecciona elemento html cuyo atributo name=\"hora_id\". El input oculto.\r\n        const inputHiddenHora = document.querySelector('[name=\"hora_id\"]');\r\n        \r\n        //asigna escuchador de evento change y función, al select de categoría del formulario\r\n        categoria.addEventListener('change', terminoBusqueda);\r\n        \r\n        //itera los dias, para poder asignar un escuchador de evento (change) y una función,\r\n        //a cada elemento dia de dias.\r\n        dias.forEach(dia => dia.addEventListener('change', terminoBusqueda));\r\n\r\n        //función terminoBusqueda que recibe eventos en (e),\r\n        //tanto de categoria como de dia\r\n        function terminoBusqueda(e){\r\n            //asigna, a la propiedad del objeto busqueda, cuya clave es igual al valor del atributo .name,\r\n            //del elemento e.target que origina el evento e,  \r\n            //le asigna el valor del atributo .value, del elemento e.target que origina el evento e. \r\n            //Resumiendo, a la propiedad categoria_id del objeto busqueda, le asigna ó 1 ó 2 (ó Conferenica ó Workshop), \r\n            //y a la propiedad dia del objeto busqueda, le asigna ó 1 ó 2 (ó Viernes ó Sabado),\r\n            busqueda[e.target.name] = e.target.value;\r\n\r\n            //**Una vez almacenados en busqueda, la categoría y o el día, seleccionados, y antes buscar eventos:\r\n            //Reiniciar el value de los campos input ocultos, del form: \r\n            inputHiddenHora.value = '';\r\n            inputHiddenDia.value = '';\r\n            //Reinicia la clase de las horas seleccionadas, del form:\r\n            //selecciona el elemento (li) con clase .horas__hora--seleccionada\r\n            const horaPrevia = document.querySelector('.horas__hora--seleccionada');\r\n            //si existe algún elemento con esa clase:\r\n            if(horaPrevia) {\r\n                //elimina la clase del elemento\r\n                horaPrevia.classList.remove('horas__hora--seleccionada');\r\n            }\r\n\r\n            //La API requiere como argumentos, dia_id y categoria_id, que obtendremos del objeto busqueda. \r\n            //Validar que no están vacios, antes de llamar a la funcion que consulta a la API.\r\n            //Si alguno de los values (atributos) del Objeto busqueda contiene '' strinc vacio, para el código\r\n            if(Object.values(busqueda).includes('')) {\r\n                return;\r\n            }\r\n\r\n            //llama a la función que consulta a la API\r\n            buscarEventos();\r\n        }\r\n\r\n        //función que consulta a la API APIEventos.php, para obtener eventos según la categoría y el día\r\n        async function buscarEventos() {\r\n\r\n            //deconstrucción de las propiedades de objeto busqueda, a dos variables con sus valores\r\n            const { dia, categoria_id} = busqueda\r\n            //define url para la consulta, incluyendo query string ? con los parametros para la API, \r\n            const url = `/api/eventos-horario?dia_id=${dia}&categoria_id=${categoria_id}`;\r\n           \r\n            //consulta fetch a la ulr de la API\r\n            const resultado = await fetch(url);\r\n            //obtiene los eventos como objetos json, del resultado de la consulta y\r\n            // los retorna como arreglo a la var eventos\r\n            const eventos = await resultado.json();\r\n\r\n            //llama metodo que obtiene las horas disponibles,\r\n            // enviando los eventos ya registrados, como argumento\r\n            obtenerHorasDisponibles(eventos);\r\n        }\r\n\r\n        //recibe los eventos ya registrados como parámetro,\r\n        //para obtener los li con las horas disponibles\r\n        function obtenerHorasDisponibles(eventos) {\r\n\r\n            //**Antes de obtener las horas disponibles, deshabilita todas las horas.\r\n            //selecciona todos los li, del elemento padre con id horas,\r\n            const listadoHoras = document.querySelectorAll('#horas li');\r\n            //itera el listado con todas las horas y les agrega la clase horas__hora--deshabilitada\r\n            listadoHoras.forEach(li => li.classList.add('horas__hora--deshabilitada'));\r\n\r\n            //**Comprobar los eventos ya registrados,\r\n            //mapea los eventos y genera un nuevo arreglo de horas, con la hora en hora_id, de cada evento,\r\n            //asigna el nuevo arreglo a horasTomadas\r\n            const horasTomadas = eventos.map( evento => evento.hora_id);\r\n\r\n            //listadoHoras es de tipo NodeList porque viene del querySelector,\r\n            //convertir el NodeList a arreglo con los li, para poder filtrarlo posteriormente\r\n            const listadoHorasArray = Array.from(listadoHoras);\r\n\r\n            //compara los li de listadoHorasArray con los li de horasTomadas, por sus atributos dataset.horaId,\r\n            //filtra los que NO ! coincidan, obteniendo un nuevo arreglo resultado con los li de la horas no tomadas\r\n            const resultado = listadoHorasArray.filter( li => !horasTomadas.includes(li.dataset.horaId))\r\n\r\n            //itera resultado con los li de las horas no reservadas y les quita la clase horas__hora--deshabilidada\r\n            resultado.forEach( li => li.classList.remove('horas__hora--deshabilitada'));\r\n\r\n            //selecciona, del elemento padre ul con id horas, \r\n            //, todos los elementos li, menos (:not) los que tienen la clase .horas__hora--deshabilitada \r\n            const horasDisponibles = document.querySelectorAll('#horas li:not(.horas__hora--deshabilitada)');\r\n            //itera horasDisponibles para asignarle un evento click y función, a cada elemento li (cada hora)\r\n            horasDisponibles.forEach(hora => hora.addEventListener('click', seleccionarHora))   \r\n        }\r\n\r\n        //se ejecuta con el evento (e) click, de cada hora del formulario\r\n        function seleccionarHora(e) {\r\n            //**deshabilitar la hora previa seleccionada, si hay nueva selección de hora\r\n            //asigna a horaPrevia, el elemento html cuya clase tenga '.horas__hora--selccionada'\r\n            const horaPrevia = document.querySelector('.horas__hora--seleccionada');\r\n            //si existe un elemento en horaPrevia:\r\n            if(horaPrevia) {\r\n                //elimina la clase del elemento (li)\r\n                horaPrevia.classList.remove('horas__hora--seleccionada')\r\n            }\r\n\r\n            //agrega la clase 'horas__hora--seleccionada,\r\n            //al elemento html (li) que dispara el evento (e) al click.\r\n            //clase agregada para dar estilos css\r\n            e.target.classList.add('horas__hora--seleccionada');\r\n\r\n            //al atributo value, del input oculto con name=\"hora_id\",\r\n            //(que hemos asisnado a la var inputHiddenHora),\r\n            //le agrega el valor del atributo personalizado (dataset) data-hora-id,\r\n            //del elemento li, que origina el evento (e), con click     \r\n            inputHiddenHora.value = e.target.dataset.horaId;\r\n\r\n            //asignar el value del dia seleccionado (checked), al value del input dia, oculto\r\n            inputHiddenDia.value = document.querySelector('[name=\"dia\"]:checked').value \r\n        }\r\n\r\n    }\r\n})();","//el código js irá dentro de una función IIFE (Inmediately Invoked Function Expresión), \r\n//esta función se autoejecuta inmediatamente despues de ser definida.\r\n//Se usa para evitar la contaminación del ámbito global y encapsular sus variables.\r\n(function() {\r\n    //selecciona el elemento con id #tags_input y la asigna a la var tagsInput\r\n    const tagsInput = document.querySelector('#tags_input');\r\n    \r\n    //si el elemento tagsInput existe, se ejecuta el código\r\n    if(tagsInput) {\r\n        \r\n        //arreglo almacena las etiquetas tecleadas en el input, cuando se teclee ,\r\n        let tags = [];\r\n\r\n        //selecciona elemento html con id #tags, donde se mostraran los tags\r\n        const tagsDiv = document.querySelector('#tags');\r\n\r\n        //selecciona elemento html del form, con el atributo name=\"tags\"\r\n        //es el input hidden (oculto) del formulario agregar ponentes\r\n        const tagsInputHidden = document.querySelector('[name=\"tags\"]');\r\n\r\n        //**Recuperar los tags del value del input hidden (oculto)\r\n        //si el atributo value de elemento tagsInputHidden, contiene info\r\n        if(tagsInputHidden.value !== '') {\r\n            //extrae los valores separados por ',' del string, \r\n            //los convierte en arreglo y los asigna a tags\r\n            tags = tagsInputHidden.value.split(',');\r\n            //llama metodo que muestra los tags en el formulario\r\n            mostrarTags()\r\n        }\r\n\r\n        //Escuchar cambios en el input, cuando se teclee algo, ejecuta función\r\n        tagsInput.addEventListener('keypress', guardarTag);\r\n\r\n        //función que recibe el evento escuchado en e\r\n        function guardarTag(e) {\r\n            //si el código de la tecla que dispara el evento e, es 44\r\n            //significa que la tecla es una coma ,\r\n            if(e.keyCode === 44) {\r\n\r\n                //validar si se teclean espacios en blanco, o no se ha tecleado nada,\r\n                //no seguir ejecutando el código\r\n                if(e.target.value.trim() === '' || e.target.value < 1) {\r\n                    return\r\n                }\r\n\r\n                //cuando se ha pulsado la coma, evita la acción por defecto del evento e\r\n                // que es escribir la coma, para que la coma , no se muestre en el input\r\n                e.preventDefault();\r\n\r\n                //como se ha pulsado la tecla coma ,\r\n                //se genera un nuevo arreglo que toma copia del arreglo tags ...tags,\r\n                //agrega el valor de lo que se haya tecleado en el input (e.target.value),\r\n                //eliminando los valores en blanco con .trim() y lo reasigna al arreglo tags\r\n                tags = [...tags, e.target.value.trim()];\r\n                \r\n                //limpia el contenido del input tagsInput, tras pulsar la coma ,\r\n                tagsInput.value = '';\r\n\r\n                //llama función mostra los tags\r\n                mostrarTags();\r\n            }\r\n        }\r\n\r\n        //Muestra cada tag en el formulario\r\n        function mostrarTags() {\r\n            //agrega al div un string vacio, para limpiar\r\n            tagsDiv.textContent = '';\r\n\r\n            //itera el arreglo tags con las etiquetas introducidas\r\n            //y por cada etiqueta en tag\r\n            tags.forEach( tag => {\r\n                //crea un elemento LI y lo asigna a etiqueta\r\n                const etiqueta = document.createElement('LI');\r\n                //agrega la clase formulario__tag al elemento LI\r\n                etiqueta.classList.add('formulario__tag');\r\n                //agrega el valor (string) de la etiqueta iterada, en tag, al LI etiqueta\r\n                etiqueta.textContent = tag;\r\n                //asigna evento dobleclick a la etiqueta, que ejecutará la función eliminarTag\r\n                etiqueta.ondblclick = eliminarTag\r\n                //inserta el LI etiqueta, como hijo del div con id #tags\r\n                tagsDiv.appendChild(etiqueta); \r\n            })\r\n\r\n            //llama la función que asigna, el tag mostrado, al input hidden (oculto)\r\n            actualizarInputHidden()\r\n        }\r\n\r\n        //elimina del DOM y del arreglo tags, el tag recibido como evento dobleclick en e,\r\n        function eliminarTag(e) {\r\n            //elimina del DOM, el elemento (tag) que origna el evento e, el e.target\r\n            e.target.remove()\r\n            //filtra y obtiene cada tag sobre el que no se haya aplicado el e.target,\r\n            //los no eliminados y los reasigna al arreglo tags\r\n            tags = tags.filter(tag => tag !== e.target.textContent)\r\n            //llama método que asigna los tags al value del input hidden, para la DB\r\n            actualizarInputHidden()\r\n        } \r\n\r\n        //función que asigna cada tag, al value de input hidden (oculto)\r\n        //para actualizarlos en la DB\r\n        function actualizarInputHidden() {\r\n            //asigna al value del input hidden, el arreglo tag convertido a string\r\n            tagsInputHidden.value = tags.toString();\r\n        }\r\n    }\r\n\r\n})();\r\n"]}